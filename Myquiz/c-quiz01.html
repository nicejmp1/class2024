<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í€´ì¦ˆ</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div id="wrap">
        <header id="header">
            <h1><a href="index.html">Quiz</a></h1>
            <div id="timer">ë‚¨ì€ ì‹œê°„ : <span id="minutes">30</span>ë¶„
                <span id="seconds">00</span>ì´ˆ
            </div>

            <nav>
                <ul>
                    <li class="active"><a href="c-quiz01.html">1</a></li>
                    <li><a href="c-quiz01.html">2</a></li>
                    <li><a href="c-quiz01.html">3</a></li>
                    <li><a href="c-quiz01.html">4</a></li>
                </ul>
            </nav>
        </header>
        <!-- //header -->
        <main id="main">
            <div class="quiz__number">
                <span id="currentQuestionNumber">1</span> / <span id="totalQuestions"></span>
            </div>
            <div class="quiz__wrap"></div>
            <div id="resultModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div class="modal-body">
                        <p id="quizResult"></p>
                    </div>
                    <div class="fireworks-container"></div>
                </div>
            </div>

        </main>
        <!-- //main -->
        <footer id="footer">
            <a href="mailto:nicejpm@naver.com">nicejpm@naver.com</a> <!-- ì´ë©”ì¼ ì£¼ì†Œ ì˜¤íƒ€ ìˆ˜ì • -->
            <button id="quiz__give"> í€´ì¦ˆ ì¢…ë£Œí•˜ê¸°</button>
        </footer>
        <!-- //footer -->
    </div>

    <script>
        let quizInfo = []; // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
        const quizWrap = document.querySelector(".quiz__wrap");
        const timeDisplay = document.getElementById("time");
        const currentQuestionNumberElement = document.getElementById('currentQuestionNumber');
        const totalQuestionsElement = document.getElementById('totalQuestions');
        let timer; // ì‹œê°„ ì œí•œì„ ìœ„í•œ íƒ€ì´ë¨¸ ë³€ìˆ˜
        let currentIndex = 0;
        let correctCount = 0; // ì •ë‹µ ìˆ˜ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜

        // ì¸ë±ìŠ¤ ê´€ë ¨ ë³€ìˆ˜ì˜ ìœ„ì¹˜ë¥¼ ì˜®ê¸°ê³ , ì´ˆê¸°í™” ë°©ì‹ ë³€ê²½
        const fetchQuiz = async () => {
            try {
                const response = await fetch("https://nicejmp1.github.io/class2024/json/gineungsaJC2005_02.json");
                if (!response.ok) throw new Error('Network response was not ok');
                const items = await response.json();
                quizInfo = items.map(item => ({
                    date: "2005ë…„ 2íšŒ",
                    type: item.subject,
                    question: item.question,
                    desc: item.desc,
                    answer: item.correct_answer
                }));
                startTimer(); // íƒ€ì´ë¨¸ ì‹œì‘
                updateQuiz(currentIndex); // í˜ì´ì§€ ë¡œë“œ í›„ ì²« ë²ˆì§¸ ë¬¸ì œë¥¼ ë³´ì—¬ì¤Œ
                // ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸
                totalQuestionsElement.textContent = quizInfo.length;
            } catch (error) {
                console.error('Fetch error:', error);
            }
        };

        const updateQuiz = (index) => {
            if (index >= quizInfo.length) {
                endQuiz();
                return;
            }

            // í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ íˆ¬ëª…ë„ ì¡°ì ˆ
            quizWrap.style.opacity = 0;


            // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸ (index + 1)
            setTimeout(() => {
                currentQuestionNumberElement.textContent = index + 1; // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                let quizWrapTag = `
                <div class="quiz">
                    <div class="quiz__header">${quizInfo[index].date} ${quizInfo[index].type}</div>
                    <div class="quiz__main">
                        <div class="question">${index + 1}. ${quizInfo[index].question}</div>
                        <div class="input">
                            <input type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!">
                        </div>
                        <div class="answer none"> ${quizInfo[index].answer}</div>
                        <div class="desc none">${quizInfo[index].desc}</div>
                    </div>
                    <div class="quiz__footer">
                        <div class="points-container"></div> <!-- í¬ì¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ì»¨í…Œì´ë„ˆ -->
                        <button class="confirm">ì •ë‹µ í™•ì¸í•˜ê¸°</button>
                        <button class="next none">ë‹¤ìŒ ë¬¸ì œ</button>
                    </div>
                </div>
                `;
                quizWrap.innerHTML = quizWrapTag;

                setTimeout(() => {
                    quizWrap.style.opacity = 1; // í˜ì´ë“œ ì¸ íš¨ê³¼

                }, 10);

                const quizConfirm = quizWrap.querySelector(".confirm");
                const quizNext = quizWrap.querySelector(".next");
                const quizGive = document.getElementById("quiz__give");


                quizConfirm.addEventListener("click", () => {
                    const userAnswer = quizWrap.querySelector("input[type='text']").value;
                    if (userAnswer === quizInfo[currentIndex].answer) {
                        quizWrap.querySelector(".quiz").classList.add("good");
                        correctCount++;
                        displayPoints('+10');
                    } else {
                        quizWrap.querySelector(".quiz").classList.add("bad");
                        quizWrap.querySelector(".answer").classList.remove("none");
                        displayPoints('-10')
                    }
                    quizConfirm.classList.add("none");
                    quizNext.classList.remove("none");
                    quizWrap.querySelector(".desc").classList.remove("none");
                });

                function displayPoints(points) {
                    const pointsContainer = document.querySelector('.points-container');
                    const point = document.createElement('div');
                    point.classList.add('points');
                    point.textContent = points; // íšë“í•œ í¬ì¸íŠ¸ ìˆ˜
                    pointsContainer.appendChild(point);

                    // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ í¬ì¸íŠ¸ ìš”ì†Œë¥¼ ì œê±°í•©ë‹ˆë‹¤.
                    point.addEventListener('animationend', () => {
                        pointsContainer.removeChild(point);
                    });
                }



                quizGive.addEventListener("click", () => {
                    clearInterval(timer);
                    endQuiz();
                })
                quizNext.addEventListener("click", () => {
                    if (currentIndex < quizInfo.length - 1) {
                        currentIndex++;
                        updateQuiz(currentIndex);
                    } else {
                        endQuiz();
                    }
                });
            }, 300);
        }
        const startTimer = () => {
            let timeLeft = 1800; // 30ë¶„ì„ ì´ˆ ë‹¨ìœ„ë¡œ
            const minutesDisplay = document.getElementById('minutes');
            const secondsDisplay = document.getElementById('seconds');
            timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                minutesDisplay.textContent = minutes;
                secondsDisplay.textContent = `${seconds < 10 ? '0' : ''}${seconds}`;
                // 10ì´ˆ ì´í•˜ì¼ ë•Œ ì´ˆ ë¶€ë¶„ì˜ í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½
                if (timeLeft <= 10) {
                    secondsDisplay.style.color = 'red';
                } else {
                    secondsDisplay.style.color = ''; // ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ì¬ì„¤ì •
                }

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endQuiz();
                }
            }, 1000);
        };

        let isQuizEnded = false; // í€´ì¦ˆê°€ ì¢…ë£Œë˜ì—ˆëŠ”ì§€ ì¶”ì í•˜ëŠ” í”Œë˜ê·¸

        const endQuiz = () => {
            clearInterval(timer); // íƒ€ì´ë¨¸ ì¤‘ì§€
            const score = (correctCount / quizInfo.length) * 100;
            const resultElement = document.getElementById("quizResult");
            const resultModal = document.getElementById("resultModal");
            const quizConfirm = quizWrap.querySelector(".confirm");
            const quizNext = quizWrap.querySelector(".next");

            if (isQuizEnded) return; // ì´ë¯¸ ì¢…ë£Œëœ í€´ì¦ˆë¼ë©´ í•¨ìˆ˜ ì‹¤í–‰ì„ ì¤‘ë‹¨
            isQuizEnded = true; // í€´ì¦ˆ ì¢…ë£Œ í”Œë˜ê·¸ ì„¤ì •

            alert("í€´ì¦ˆê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            quizConfirm.classList.add("none");
            quizNext.classList.add("none");
            resultElement.innerHTML = `
            ğŸ‰ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤ğŸ‰ 
             <p>ì´ ì ìˆ˜: ${score.toFixed(2)}ì </p>

             <p>ë§íŒ ë¬¸ì œ ìˆ˜: ${correctCount}ê°œ</p>
          
            `;
            // ëª¨ë‹¬ ì°½ì„ ë³´ì´ê²Œ í•¨
            resultModal.style.display = "block";
            // í­ì£½ íš¨ê³¼ë¥¼ ì‹¤í–‰
            showFireworks();
        };

        function showFireworks() {
            const container = document.querySelector('.fireworks-container');
            container.innerHTML = ''; // ì´ì „ í­ì£½ íš¨ê³¼ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.

            for (let i = 0; i < 100; i++) { // 100ê°œì˜ í­ì£½ ì…ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                const particle = document.createElement('div');
                particle.classList.add('firework-particle');
                container.appendChild(particle);

                // ëœë¤í•œ ë°©í–¥ê³¼ ì†ë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
                const angle = Math.random() * Math.PI * 2; // 0ì—ì„œ 2íŒŒì´(360ë„) ì‚¬ì´ì˜ ê°’
                const speed = Math.random() * 120 + 80; // 80ì—ì„œ 200 í”½ì…€ ì‚¬ì´ì˜ ì†ë„
                const x = Math.cos(angle) * speed; // xì¶• ì´ë™ ê±°ë¦¬
                const y = Math.sin(angle) * speed; // yì¶• ì´ë™ ê±°ë¦¬

                // CSS ì´ˆê¸° ì„¤ì •
                particle.style.left = '50%'; // ì»¨í…Œì´ë„ˆ ì¤‘ì•™ì—ì„œ ì‹œì‘
                particle.style.top = '50%';
                particle.style.position = 'absolute';
                particle.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`; // ìƒ‰ìƒ ëœë¤í™”
                particle.style.borderRadius = '50%';
                particle.style.width = '5px';
                particle.style.height = '5px';
                particle.style.opacity = 1;
                particle.style.transform = 'translate(-50%, -50%)'; // ì¤‘ì•™ ì •ë ¬ ë³´ì •

                // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                particle.animate([
                    { transform: `translate(-50%, -50%) scale(1)`, opacity: 2 },
                    { transform: `translate(${x}px, ${y}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 1000 + Math.random() * 800, // 700msì—ì„œ 1000ms ì‚¬ì´ì˜ ì§€ì† ì‹œê°„
                    easing: 'ease-out',
                    fill: 'forwards'
                });

                // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ ì…ì ì œê±°
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
        }
        // ëª¨ë‹¬ì˜ ë‹«ê¸° ë²„íŠ¼ì— ëŒ€í•œ ì²˜ë¦¬
        const closeModal = () => {
            const resultModal = document.getElementById("resultModal");
            resultModal.style.display = "none";
        }

        // ë‹«ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ì„ ë‹«ìŒ
        document.querySelector('.close').onclick = closeModal;

        // ìœˆë„ìš°ì˜ ì–´ëŠ ë¶€ë¶„ì´ë¼ë„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ì„ ë‹«ìŒ
        window.onclick = (event) => {
            const resultModal = document.getElementById("resultModal");
            if (event.target == resultModal) {
                resultModal.style.display = "none";
            }
        }
        document.addEventListener("DOMContentLoaded", fetchQuiz);
    </script>
</body>

</html>